<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chikai Maps</title>
    <link rel="stylesheet" href="/static/styles.css?v=41" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  </head>
  <body>
    <!-- FULL-SCREEN MAP -->
    <div id="map-container" class="map-fullscreen">
      <div id="leaflet-map"></div>
    </div>

    <!-- LEFT WIDGET - Controls Panel -->
    <aside id="controls-widget" class="floating-widget widget-left">
      <div class="widget-content">
        <!-- Header/Brand -->
        <header class="widget-header">
          <div class="brand">
            <span class="brand-mark"></span>
            <span class="brand-text">Chikai Maps</span>
          </div>
          <div class="header-actions">
            <button id="header-gallery-btn" class="header-icon-btn" type="button" title="Your Posters">
              <svg viewBox="0 0 24 24" width="18" height="18">
                <path fill="currentColor" d="M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zm-11-4l2.03 2.71L16 11l4 5H8l3-4zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z"/>
              </svg>
            </button>
            <button id="header-mockup-gallery-btn" class="header-icon-btn" type="button" title="Your Mockups">
              <svg viewBox="0 0 24 24" width="18" height="18">
                <path fill="currentColor" d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/>
              </svg>
            </button>
            <button id="header-mockup-btn" class="header-icon-btn" type="button" title="Mockup Studio">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <rect x="3" y="3" width="7" height="9"></rect> <rect x="14" y="3" width="7" height="5"></rect> <rect x="14" y="12" width="7" height="9"></rect> <rect x="3" y="16" width="7" height="5"></rect> </g></svg>
            </button>
            <a href="/editor" id="header-editor-btn" class="header-icon-btn" title="Theme Editor">
              <svg viewBox="0 0 24 24" width="18" height="18">
                <path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
              </svg>
            </a>
          </div>
        </header>

        <!-- Poster Text (editable, decoupled from map) -->
        <section class="widget-section">
          <div class="section-header-row">
            <label class="section-label">Poster Text</label>
            <span class="section-hint-inline">Edit or click sync for suggestion</span>
          </div>
          <div class="field-row">
            <input type="text" id="poster-city" placeholder="City name" />
            <button id="sync-city" class="sync-btn" type="button" title="Use suggested city">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0 0 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 0 0 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
              </svg>
            </button>
          </div>
          <div class="field-row">
            <input type="text" id="poster-country" placeholder="Country" />
            <button id="sync-country" class="sync-btn" type="button" title="Use suggested country">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0 0 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 0 0 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
              </svg>
            </button>
          </div>
          <div class="field-row">
            <input type="text" id="poster-tagline" placeholder="Tagline (empty = coordinates)" />
            <button id="sync-tagline" class="sync-btn" type="button" title="Reset to coordinates">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0 0 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 0 0 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
              </svg>
            </button>
          </div>
        </section>

        <!-- Radius Slider -->
        <section class="widget-section">
          <div class="slider-header">
            <label class="section-label" for="radius-slider">Radius</label>
            <span class="section-hint-inline">4-6km districts, 8-12km downtown, 15-20km metros</span>
            <span id="radius-value" class="slider-value">29 km</span>
          </div>
          <input
            type="range"
            id="radius-slider"
            min="2000"
            max="30000"
            step="500"
            value="29000"
          />
        </section>

        <!-- DPI Slider -->
        <section class="widget-section">
          <div class="slider-header">
            <label class="section-label" for="dpi-slider">Resolution (DPI)</label>
            <span id="dpi-value" class="slider-value">300</span>
          </div>
          <input
            type="range"
            id="dpi-slider"
            min="72"
            max="600"
            step="1"
            value="300"
          />
        </section>

        <!-- Output Format -->
        <section class="widget-section inline-row">
          <label class="inline-label" for="format-select">Format</label>
          <select id="format-select" class="inline-select">
            <option value="png" selected>PNG (Raster)</option>
            <option value="svg">SVG (Vector)</option>
            <option value="pdf">PDF (Print)</option>
            <option value="svg-laser">SVG Laser (CNC)</option>
          </select>
        </section>

        <!-- Preset Bundles -->
        <section class="widget-section inline-row">
          <label class="inline-label">Preset</label>
          <select id="preset-select" class="inline-select preset-select">
            <option value="">Custom</option>
          </select>
          <button id="save-preset-btn" class="icon-btn save-preset-btn" type="button" title="Save current settings as preset">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
            </svg>
          </button>
        </section>

        <!-- Design Options Group -->
        <div class="options-group">
          <div class="options-group-label">Design Options</div>

          <!-- Aspect Ratio / Size -->
          <section class="widget-section inline-row">
            <label class="inline-label" for="aspect-select">Size</label>
            <select id="aspect-select" class="inline-select">
              <option value="2:3" selected>2:3 Poster (24×36")</option>
              <option value="3:4">3:4 Photo (18×24")</option>
              <option value="4:5">4:5 Frame (16×20")</option>
              <option value="5:7">5:7 Frame (5×7")</option>
              <option value="11:14">11:14 Frame</option>
              <option value="1:1">1:1 Square</option>
              <option value="16:9">16:9 Landscape</option>
              <option value="9:16">9:16 Portrait</option>
              <option value="A4">A4 (ISO)</option>
              <option value="A3">A3 (ISO)</option>
            </select>
          </section>

          <!-- Font -->
          <section class="widget-section font-section">
            <div class="font-header">
              <label class="section-label">Font</label>
              <button id="browse-fonts-btn" class="browse-link" type="button">Browse All</button>
            </div>
            <div class="font-controls">
              <select id="font-collection-filter" class="inline-select font-collection-filter">
                <option value="">All Fonts</option>
                <option value="starred">Starred</option>
              </select>
              <div id="font-picker" class="font-picker inline-picker">
                <button type="button" id="font-picker-toggle" class="font-picker-toggle">
                  <span id="font-picker-label">Loading...</span>
                  <svg viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M7 10l5 5 5-5z"/>
                  </svg>
                </button>
                <div id="font-picker-dropdown" class="font-picker-dropdown" aria-hidden="true">
                  <div id="font-picker-options" class="font-picker-options"></div>
                </div>
              </div>
            </div>
          </section>

          <!-- Center Pin Icon -->
          <section class="widget-section pin-section">
            <label class="section-label">Center Pin</label>
            <div id="pin-selector" class="pin-selector">
              <button type="button" class="pin-option selected" data-pin="none" title="No pin">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="1.5" stroke-dasharray="3 2"/>
                </svg>
              </button>
              <button type="button" class="pin-option" data-pin="marker" title="Map marker">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                </svg>
              </button>
              <button type="button" class="pin-option" data-pin="heart" title="Heart">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
              </button>
              <button type="button" class="pin-option" data-pin="star" title="Star">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                </svg>
              </button>
              <button type="button" class="pin-option" data-pin="home" title="Home">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
              </button>
              <button type="button" class="pin-option" data-pin="circle" title="Circle dot">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <circle cx="12" cy="12" r="8" fill="currentColor"/>
                </svg>
              </button>
            </div>
            <div id="pin-color-selector" class="pin-color-selector" style="display: none;">
              <span class="pin-color-label">Color:</span>
              <div id="pin-color-swatches" class="pin-color-swatches">
                <!-- Swatches populated dynamically from theme colors -->
              </div>
            </div>
          </section>

          <!-- Theme Carousel -->
          <section class="widget-section theme-section">
            <div class="theme-header">
              <label class="section-label">Theme</label>
              <div class="theme-header-actions">
                <div id="theme-view-toggle" class="theme-view-toggle">
                  <button type="button" class="view-toggle-btn" data-view="category" title="Category">
                    <svg viewBox="0 0 24 24" width="14" height="14">
                      <path fill="currentColor" d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                    </svg>
                  </button>
                  <button type="button" class="view-toggle-btn active" data-view="collection" title="Etsy Type">
                    <svg viewBox="0 0 24 24" width="14" height="14">
                      <path fill="currentColor" d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/>
                    </svg>
                  </button>
                </div>
                <button id="variation-mode-btn" class="variation-toggle" type="button" title="Multi-select themes for variations">
                  <svg viewBox="0 0 24 24" width="14" height="14">
                    <path fill="currentColor" d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/>
                  </svg>
                </button>
                <button id="browse-themes-btn" class="browse-link" type="button">Browse All</button>
              </div>
            </div>
            <div id="theme-category-tabs" class="theme-category-tabs"></div>
            <div id="theme-carousel-wrap" class="theme-carousel-wrap">
              <div class="carousel-fade-left"></div>
              <div id="theme-carousel" class="theme-carousel"></div>
              <div class="carousel-fade-right"></div>
            </div>
          </section>

          <!-- Collection -->
          <section class="widget-section inline-row">
            <label class="inline-label">Collection</label>
            <div class="collection-select-wrap">
              <select id="collection-select" class="inline-select">
                <option value="">None</option>
              </select>
              <button id="add-collection-btn" class="icon-btn" type="button" title="Create new collection">
                <svg viewBox="0 0 24 24" width="16" height="16">
                  <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
              </button>
            </div>
          </section>

        </div><!-- /options-group -->

      </div>
    </aside>

    <!-- PREVIEW WIDGET - Live theme/font preview + Generate controls -->
    <aside id="preview-widget" class="floating-widget widget-preview">
      <div class="preview-header">
        <span class="preview-title">Preview</span>
        <button id="preview-close" class="preview-close" type="button" aria-label="Close preview">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      <div id="preview-container" class="preview-container">
        <!-- SVG will be loaded here -->
      </div>
      <div class="preview-footer">
        <span class="preview-theme-name" id="preview-theme-name">Feature-Based</span>
      </div>

      <!-- Selected Themes List (visible in multi-theme mode) -->
      <div id="selected-themes-section" class="selected-themes-section" style="display: none;">
        <div class="selected-themes-header">
          <span>Selected Themes</span>
          <span id="selected-themes-count" class="selected-themes-count">0</span>
        </div>
        <div id="selected-themes-list" class="selected-themes-list">
          <!-- Selected themes rendered here -->
        </div>
      </div>

      <!-- Generate Button -->
      <div class="preview-generate-section">
        <div class="generate-buttons">
          <button id="generate-btn" class="primary-btn" type="button" disabled>
            Select location
          </button>
          <button id="add-queue-btn" class="secondary-btn queue-btn" type="button" disabled title="Add to queue">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Queue Panel -->
      <div id="queue-section" class="preview-queue-section" style="display: none;">
        <div class="queue-header">
          <span class="queue-title">Queue</span>
          <span id="queue-count" class="queue-count">0 jobs</span>
          <button id="clear-queue-btn" class="ghost-btn queue-clear-btn" type="button" title="Clear queue">Clear</button>
        </div>
        <div id="queue-list" class="queue-list"></div>
      </div>

      <div class="preview-resize-handle" id="preview-resize-handle">
        <svg viewBox="0 0 24 24" width="12" height="12">
          <path fill="currentColor" d="M22 22H20V20H22V22ZM22 18H20V16H22V18ZM18 22H16V20H18V22ZM22 14H20V12H22V14ZM18 18H16V16H18V18ZM14 22H12V20H14V22Z"/>
        </svg>
      </div>
    </aside>

    <!-- TOP-RIGHT WIDGET - Progress & Latest Poster -->
    <aside id="status-widget" class="floating-widget widget-top-right">
      <!-- Progress Widget (hidden until generating) -->
      <section id="progress-section" class="widget-section progress-widget" style="display: none;">
        <div class="progress-status">
          <span id="progress-message">Generating...</span>
          <span id="progress-percent">0%</span>
        </div>
        <div class="progress-bar">
          <div id="progress-fill" class="progress-fill"></div>
        </div>
        <div id="progress-stage" class="progress-stage"></div>
        <p id="progress-error" class="progress-error" role="alert"></p>
      </section>

      <!-- Latest Poster (shown after generation) -->
      <section id="latest-section" class="widget-section latest-section" style="display: none;">
        <div class="latest-header">
          <span class="latest-label">Latest:</span>
          <a id="latest-link" href="#" target="_blank" class="latest-download">Download</a>
        </div>
        <a id="latest-poster-link" href="#" target="_blank" class="latest-thumb-link">
          <img id="latest-poster-thumb" alt="Latest poster" class="latest-thumb" />
        </a>
      </section>
    </aside>

    <!-- BOTTOM-RIGHT WIDGETS - Coords & Map Style -->
    <div class="bottom-right-group">
      <!-- Selected Location -->
      <aside id="coords-widget" class="floating-widget coords-widget">
        <div class="coords-display">
          <span id="selected-coords" class="coords-value">Click on map</span>
          <span id="suggested-location" class="suggested-location"></span>
        </div>
      </aside>

      <!-- Map Style Selector -->
      <aside id="style-widget" class="floating-widget widget-bottom-right">
      <button id="style-toggle" class="style-toggle" type="button" aria-label="Change map style">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <path fill="currentColor" d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"/>
        </svg>
      </button>
      <div id="style-dropdown" class="style-dropdown" aria-hidden="true">
        <div class="style-dropdown-header">Map Style</div>
        <div class="style-options">
          <label class="style-option">
            <input type="radio" name="map-style" value="cartodb-voyager" checked />
            <span class="style-preview" style="background: linear-gradient(135deg, #e8e0d8 50%, #b8d4e3 50%);"></span>
            <span class="style-name">Voyager</span>
          </label>
          <label class="style-option">
            <input type="radio" name="map-style" value="cartodb-positron" />
            <span class="style-preview" style="background: linear-gradient(135deg, #f2f2f2 50%, #d4e4ed 50%);"></span>
            <span class="style-name">Light</span>
          </label>
          <label class="style-option">
            <input type="radio" name="map-style" value="cartodb-dark" />
            <span class="style-preview" style="background: linear-gradient(135deg, #2b2b2b 50%, #3d5c6e 50%);"></span>
            <span class="style-name">Dark</span>
          </label>
          <label class="style-option">
            <input type="radio" name="map-style" value="osm-standard" />
            <span class="style-preview" style="background: linear-gradient(135deg, #f2efe9 50%, #aad3df 50%);"></span>
            <span class="style-name">OSM</span>
          </label>
          <label class="style-option">
            <input type="radio" name="map-style" value="osm-hot" />
            <span class="style-preview" style="background: linear-gradient(135deg, #f0e6d2 50%, #99c9e9 50%);"></span>
            <span class="style-name">Humanitarian</span>
          </label>
          <label class="style-option">
            <input type="radio" name="map-style" value="stamen-toner" />
            <span class="style-preview" style="background: linear-gradient(135deg, #fff 50%, #ccc 50%);"></span>
            <span class="style-name">Toner</span>
          </label>
        </div>
      </div>
    </aside>
    </div>

    <!-- THEME DRAWER (Full-screen overlay) -->
    <div id="theme-drawer" class="theme-drawer" aria-hidden="true">
      <div class="drawer-header">
        <h3>Select Theme</h3>
        <input type="text" id="theme-search" placeholder="Filter themes..." />
        <button id="theme-samples-btn" class="drawer-action-btn" type="button" title="Theme Samples">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
          </svg>
        </button>
        <button id="drawer-close" class="drawer-close" type="button" aria-label="Close">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      <div id="theme-collection-tabs" class="theme-collection-tabs"></div>
      <div id="theme-grid-full" class="theme-grid-expanded"></div>
    </div>

    <!-- FONT DRAWER (Full-screen overlay) -->
    <div id="font-drawer" class="font-drawer" aria-hidden="true">
      <div class="drawer-header">
        <h3>Browse Fonts</h3>
        <input type="text" id="font-search" placeholder="Filter fonts..." />
        <button id="font-samples-btn" class="drawer-action-btn" type="button" title="Font Samples">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M9.93 13.5h4.14L12 7.98 9.93 13.5zM20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-4.05 16.5l-1.14-3H9.17l-1.12 3H5.96l5.11-13h1.86l5.11 13h-2.09z"/>
          </svg>
        </button>
        <button id="font-drawer-close" class="drawer-close" type="button" aria-label="Close">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      <div id="font-collection-tabs" class="font-collection-tabs"></div>
      <div id="font-grid-full" class="font-grid-expanded"></div>
    </div>

    <!-- GALLERY / COLLECTIONS MODAL -->
    <div class="collection-modal" id="collection-modal" aria-hidden="true">
      <div class="collection-modal-backdrop"></div>
      <div class="collection-modal-panel">
        <div class="collection-modal-header">
          <h3>Your Posters</h3>
          <button id="gallery-multiselect-btn" class="ghost-btn" type="button" title="Multi-select mode">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM17.99 9l-1.41-1.42-6.59 6.59-2.58-2.57-1.42 1.41 4 3.99z"/>
            </svg>
            Select
          </button>
          <button id="add-collection-modal-btn" class="ghost-btn" type="button" title="Create new collection">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            New Collection
          </button>
          <button id="open-folder-btn" class="ghost-btn" type="button" title="Open posters folder">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path fill="currentColor" d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/>
            </svg>
            Open Folder
          </button>
          <button class="collection-modal-close" id="collection-modal-close" type="button">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="gallery-bulk-actions" id="gallery-bulk-actions">
          <div class="bulk-actions-left">
            <button id="gallery-select-all-btn" class="ghost-btn" type="button">Select All</button>
            <span class="bulk-selection-count" id="bulk-selection-count">0 selected</span>
          </div>
          <div class="bulk-actions-right">
            <button id="bulk-create-composite-btn" class="ghost-btn" type="button" title="Create variations poster composite">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/>
              </svg>
              Create Composite
            </button>
            <button id="bulk-delete-btn" class="ghost-btn danger" type="button" title="Delete selected">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
              </svg>
              Delete Selected
            </button>
            <button id="gallery-cancel-select-btn" class="ghost-btn" type="button">Cancel</button>
          </div>
        </div>
        <div class="collection-modal-tabs" id="collection-modal-tabs">
          <!-- Collection tabs will be rendered here -->
        </div>
        <div class="collection-modal-grid" id="collection-modal-grid">
          <!-- Poster images will be rendered here -->
        </div>
      </div>
    </div>

    <!-- LIGHTBOX -->
    <div class="lightbox" id="lightbox" aria-hidden="true">
      <div class="lightbox-backdrop" data-lightbox-close="true"></div>
      <div class="lightbox-panel" role="dialog" aria-modal="true">
        <div class="lightbox-toolbar">
          <a class="lightbox-download" id="lightbox-download" href="#" download title="Download full size">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
            </svg>
          </a>
          <button class="lightbox-close" type="button" data-lightbox-close="true">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <button class="lightbox-nav prev" type="button" data-lightbox-prev="true">
          <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
          </svg>
        </button>
        <div class="lightbox-image-wrap">
          <img id="lightbox-image" alt="Poster preview" />
        </div>
        <button class="lightbox-nav next" type="button" data-lightbox-next="true">
          <svg viewBox="0 0 24 24" width="32" height="32">
            <path fill="currentColor" d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
          </svg>
        </button>
        <div class="lightbox-caption" id="lightbox-caption"></div>
        <div class="lightbox-strip" id="lightbox-strip"></div>
      </div>
    </div>

    <!-- MOCKUP MODAL -->
    <div class="mockup-modal" id="mockup-modal" aria-hidden="true">
      <div class="mockup-modal-backdrop"></div>
      <div class="mockup-modal-panel" role="dialog" aria-modal="true">
        <div class="mockup-modal-header">
          <h3>Choose Mockup Template</h3>
          <button class="mockup-create-btn" id="mockup-create-btn" type="button" title="Create new template">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            New Template
          </button>
          <button class="mockup-modal-close" id="mockup-close" type="button">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="mockup-modal-filters">
          <div id="mockup-modal-collection-tabs" class="mockup-modal-collection-tabs"></div>
          <div class="mockup-aspect-filter-wrap">
            <label>Aspect:</label>
            <select id="mockup-aspect-filter" class="mockup-aspect-filter">
              <option value="">All</option>
              <option value="2:3">2:3</option>
              <option value="3:4">3:4</option>
              <option value="4:5">4:5</option>
              <option value="5:7">5:7</option>
              <option value="11:14">11:14</option>
              <option value="1:1">1:1</option>
              <option value="A4">A4</option>
              <option value="A3">A3</option>
              <option value="3:2">3:2</option>
              <option value="16:9">16:9</option>
              <option value="9:16">9:16</option>
            </select>
          </div>
        </div>
        <div class="mockup-grid" id="mockup-grid">
          <div class="mockup-placeholder">Loading mockup templates...</div>
        </div>
      </div>
    </div>

    <!-- MOCKUP PREVIEW -->
    <div class="mockup-preview" id="mockup-preview" aria-hidden="true">
      <div class="mockup-preview-backdrop"></div>
      <div class="mockup-preview-panel" role="dialog" aria-modal="true">
        <div class="mockup-preview-header">
          <button class="mockup-preview-back" id="mockup-preview-back" type="button" title="Back to templates">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            <span>Templates</span>
          </button>
          <h3>Adjust Mockup</h3>
          <button class="mockup-preview-close" id="mockup-preview-close" type="button">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="mockup-preview-body">
          <div class="mockup-preview-canvas-wrap">
            <div class="canvas-zoom-controls">
              <button type="button" class="zoom-btn" id="preview-zoom-out" title="Zoom out">-</button>
              <span class="zoom-level" id="preview-zoom-level">100%</span>
              <button type="button" class="zoom-btn" id="preview-zoom-in" title="Zoom in">+</button>
              <button type="button" class="zoom-btn zoom-fit" id="preview-zoom-fit" title="Fit to view">Fit</button>
            </div>
            <canvas id="mockup-preview-canvas"></canvas>
          </div>
          <div class="mockup-preview-sidebar">
            <div class="mockup-preview-actions-compact">
              <button type="button" class="compact-btn secondary" id="mockup-preview-reset">Reset</button>
              <button type="button" class="compact-btn primary" id="mockup-preview-generate">Generate</button>
            </div>

            <!-- Layers Section -->
            <div class="mockup-layers-section">
              <div class="section-header-row">
                <label>Layers</label>
                <div class="mockup-labels-buttons">
                  <button type="button" class="label-btn-sm" id="add-theme-label" title="Add theme name">Theme</button>
                  <button type="button" class="label-btn-sm" id="add-font-label" title="Add font name">Font</button>
                  <button type="button" class="label-btn-sm" id="add-aspect-label" title="Add aspect ratio">Ratio</button>
                  <button type="button" class="label-btn-sm" id="add-custom-label" title="Add custom text">+</button>
                  <button type="button" class="label-btn-sm asset-btn" id="add-asset-layer" title="Upload image asset">
                    <svg viewBox="0 0 24 24" width="14" height="14">
                      <path fill="currentColor" d="M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"/>
                    </svg>
                  </button>
                </div>
                <input type="file" id="asset-file-input" accept="image/png,image/jpeg,image/webp" style="display: none;">
              </div>
              <div id="mockup-labels-list" class="mockup-labels-list"></div>
              <!-- Asset Controls (shown when asset selected) -->
              <div id="mockup-asset-controls" class="mockup-asset-controls" style="display: none;">
                <div class="adjust-row">
                  <label>Width</label>
                  <input type="range" id="asset-width-slider" min="5" max="100" step="1" value="20">
                  <span class="slider-value" id="asset-width-value">20%</span>
                </div>
                <div class="adjust-row">
                  <label>Opacity</label>
                  <input type="range" id="asset-opacity-slider" min="0" max="1" step="0.05" value="1">
                  <span class="slider-value" id="asset-opacity-value">100%</span>
                </div>
              </div>
              <div class="mockup-labels-row">
                <select id="mockup-label-font" class="mockup-label-select">
                  <option value="Arial">Arial</option>
                </select>
                <input type="number" id="mockup-label-size" value="24" min="8" max="120" class="mockup-label-size" title="Font size">
                <label class="mockup-shadow-toggle" title="Drop shadow">
                  <input type="checkbox" id="mockup-label-shadow" checked>
                  <span class="shadow-icon">
                    <svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M3 5h18v14H3V5zm2 2v10h14V7H5zm7 8l4-4h-3V8h-2v3H8l4 4z" opacity="0.6"/></svg>
                  </span>
                </label>
              </div>
              <div class="mockup-color-row">
                <div class="color-swatches" id="mockup-color-swatches">
                  <button type="button" class="swatch" data-color="#ffffff" style="background:#ffffff" title="White"></button>
                  <button type="button" class="swatch" data-color="#000000" style="background:#000000" title="Black"></button>
                  <button type="button" class="swatch" data-color="#f5f5f5" style="background:#f5f5f5" title="Off-white"></button>
                  <button type="button" class="swatch" data-color="#333333" style="background:#333333" title="Dark gray"></button>
                  <button type="button" class="swatch" data-color="#c86432" style="background:#c86432" title="Terracotta"></button>
                  <button type="button" class="swatch" data-color="#e6c47a" style="background:#e6c47a" title="Gold"></button>
                  <button type="button" class="swatch" data-color="#4a90a4" style="background:#4a90a4" title="Teal"></button>
                  <button type="button" class="swatch" data-color="#8b4513" style="background:#8b4513" title="Brown"></button>
                </div>
                <input type="color" id="mockup-label-color" value="#ffffff" class="mockup-label-color" title="Custom color">
              </div>
            </div>

            <!-- Poster Adjustments -->
            <div class="mockup-adjustments">
              <div class="adjust-row">
                <label>Scale</label>
                <input type="range" id="mockup-scale-slider" min="0.1" max="2" step="0.01" value="1">
                <input type="text" class="slider-value-input" id="mockup-scale-value" value="100%">
              </div>
              <div class="adjust-row">
                <label>X</label>
                <button type="button" class="nudge-btn" data-target="mockup-x-slider" data-delta="-1" title="-1px">&lt;</button>
                <input type="range" id="mockup-x-slider" min="-500" max="500" step="1" value="0">
                <button type="button" class="nudge-btn" data-target="mockup-x-slider" data-delta="1" title="+1px">&gt;</button>
                <input type="text" class="slider-value-input" id="mockup-x-value" value="0px">
              </div>
              <div class="adjust-row">
                <label>Y</label>
                <button type="button" class="nudge-btn" data-target="mockup-y-slider" data-delta="-1" title="-1px">&lt;</button>
                <input type="range" id="mockup-y-slider" min="-500" max="500" step="1" value="0">
                <button type="button" class="nudge-btn" data-target="mockup-y-slider" data-delta="1" title="+1px">&gt;</button>
                <input type="text" class="slider-value-input" id="mockup-y-value" value="0px">
              </div>
            </div>

            <!-- Guides Section -->
            <div class="mockup-guides-section">
              <div class="guides-header">
                <span>Guides</span>
                <div class="guides-buttons">
                  <button type="button" class="guide-add-btn" id="add-h-guide" title="Add horizontal guide">H</button>
                  <button type="button" class="guide-add-btn" id="add-v-guide" title="Add vertical guide">V</button>
                  <button type="button" class="guide-clear-btn" id="clear-guides" title="Clear all guides">Clear</button>
                </div>
              </div>
              <div id="mockup-guides-list" class="mockup-guides-list"></div>
              <label class="snap-toggle">
                <input type="checkbox" id="mockup-snap-enabled" checked>
                <span>Snap to guides</span>
              </label>
            </div>

            <!-- Library Section -->
            <div class="mockup-library-section">
              <div class="library-header">
                <span>Library</span>
              </div>
              <div id="mockup-library-grid" class="mockup-library-grid">
                <!-- Library items loaded dynamically -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MOCKUP STUDIO -->
    <div class="mockup-studio" id="mockup-studio" aria-hidden="true">
      <div class="mockup-studio-backdrop"></div>
      <div class="mockup-studio-panel" role="dialog" aria-modal="true">
        <div class="mockup-studio-header">
          <div class="mockup-studio-title">
            <h3>Mockup Studio</h3>
            <span class="mockup-studio-breadcrumb" id="mockup-studio-breadcrumb"></span>
          </div>
          <button class="mockup-studio-close" id="mockup-studio-close" type="button">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="mockup-studio-body">
          <!-- Step 1: Template Selection -->
          <div class="mockup-studio-step" id="mockup-studio-templates" data-step="templates">
            <div class="mockup-studio-step-header">
              <h4>Select a Mockup Template</h4>
              <button type="button" class="secondary-btn" id="mockup-studio-add-template">
                <svg viewBox="0 0 24 24" width="16" height="16">
                  <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                Add Template
              </button>
            </div>
            <div class="mockup-studio-filters">
              <div id="mockup-studio-collection-tabs" class="mockup-studio-collection-tabs"></div>
              <div class="mockup-aspect-filter-wrap">
                <label>Aspect:</label>
                <select id="mockup-studio-aspect-filter" class="mockup-aspect-filter">
                  <option value="">All</option>
                  <option value="2:3">2:3</option>
                  <option value="3:4">3:4</option>
                  <option value="4:5">4:5</option>
                  <option value="5:7">5:7</option>
                  <option value="11:14">11:14</option>
                  <option value="1:1">1:1</option>
                  <option value="A4">A4</option>
                  <option value="A3">A3</option>
                  <option value="3:2">3:2</option>
                  <option value="16:9">16:9</option>
                  <option value="9:16">9:16</option>
                </select>
              </div>
            </div>
            <div class="mockup-studio-grid" id="mockup-studio-template-grid">
              <!-- Templates rendered here -->
            </div>
          </div>

          <!-- Step 2: Poster Selection -->
          <div class="mockup-studio-step hidden" id="mockup-studio-posters" data-step="posters">
            <div class="mockup-studio-step-header">
              <button type="button" class="mockup-studio-back" id="mockup-studio-back">
                <svg viewBox="0 0 24 24" width="20" height="20">
                  <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                Back
              </button>
              <h4>Select a Poster</h4>
              <div class="mockup-studio-filter">
                <select id="mockup-studio-collection-filter">
                  <option value="">All Posters</option>
                </select>
              </div>
            </div>
            <div class="mockup-studio-selected-template" id="mockup-studio-selected-template">
              <!-- Selected template preview shown here -->
            </div>
            <div class="mockup-studio-grid poster-grid" id="mockup-studio-poster-grid">
              <!-- Posters rendered here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MOCKUP OUTPUT GALLERY -->
    <div class="mockup-gallery" id="mockup-gallery" aria-hidden="true">
      <div class="mockup-gallery-backdrop"></div>
      <div class="mockup-gallery-panel" role="dialog" aria-modal="true">
        <div class="mockup-gallery-header">
          <h3>Generated Mockups</h3>
          <div class="mockup-gallery-actions">
            <button type="button" class="secondary-btn" id="mockup-gallery-open-folder" title="Open folder">
              <svg viewBox="0 0 24 24" width="16" height="16">
                <path fill="currentColor" d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/>
              </svg>
            </button>
            <button class="mockup-gallery-close" id="mockup-gallery-close" type="button">
              <svg viewBox="0 0 24 24" width="24" height="24">
                <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="mockup-gallery-body">
          <div class="mockup-gallery-grid" id="mockup-gallery-grid">
            <!-- Generated mockups rendered here -->
          </div>
          <div class="mockup-gallery-empty" id="mockup-gallery-empty" style="display: none;">
            <p>No mockups generated yet.</p>
            <p class="hint">Use the Mockup Studio to create mockups from your posters.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- MOCKUP IMAGE EDITOR -->
    <div class="mockup-image-editor" id="mockup-image-editor" aria-hidden="true">
      <div class="mockup-image-editor-backdrop"></div>
      <div class="mockup-image-editor-panel" role="dialog" aria-modal="true">
        <div class="mockup-image-editor-header">
          <h3>Edit Mockup</h3>
          <button class="mockup-image-editor-close" id="mockup-image-editor-close" type="button">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="mockup-image-editor-body">
          <div class="mockup-image-editor-sidebar">
            <div class="editor-field">
              <label>Output Size</label>
              <div class="editor-size-inputs">
                <div class="editor-size-input">
                  <label>W</label>
                  <input type="number" id="editor-crop-width" value="1080" min="100" max="4000">
                </div>
                <span class="editor-size-link" id="editor-size-link" title="Link dimensions">
                  <svg viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
                  </svg>
                </span>
                <div class="editor-size-input">
                  <label>H</label>
                  <input type="number" id="editor-crop-height" value="1080" min="100" max="4000">
                </div>
              </div>
              <div class="editor-presets">
                <button type="button" class="editor-preset-btn" data-w="1080" data-h="1080">1:1</button>
                <button type="button" class="editor-preset-btn" data-w="1080" data-h="1350">4:5</button>
                <button type="button" class="editor-preset-btn" data-w="1080" data-h="1920">9:16</button>
                <button type="button" class="editor-preset-btn" data-w="1920" data-h="1080">16:9</button>
              </div>
            </div>
            <div class="editor-field">
              <label>Zoom</label>
              <div class="editor-zoom-row">
                <button type="button" class="editor-zoom-btn" id="editor-zoom-out">−</button>
                <input type="range" id="editor-zoom-slider" min="10" max="200" value="100">
                <button type="button" class="editor-zoom-btn" id="editor-zoom-in">+</button>
                <span class="editor-zoom-value" id="editor-zoom-value">100%</span>
              </div>
            </div>
            <div class="editor-field">
              <label>Position</label>
              <p class="field-hint">Drag the image to reposition within the crop area.</p>
            </div>
            <button type="button" class="primary-btn" id="editor-save-btn">Save as New Mockup</button>
          </div>
          <div class="mockup-image-editor-canvas-area">
            <div class="mockup-image-editor-canvas-wrap" id="editor-canvas-wrap">
              <canvas id="mockup-image-editor-canvas"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MOCKUP TEMPLATE CREATOR -->
    <div class="mockup-creator" id="mockup-creator" aria-hidden="true">
      <div class="mockup-creator-backdrop"></div>
      <div class="mockup-creator-panel" role="dialog" aria-modal="true">
        <div class="mockup-creator-header">
          <button type="button" class="mockup-creator-back" id="mockup-creator-back" style="display: none;" title="Back to templates">
            <svg viewBox="0 0 24 24" width="20" height="20">
              <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
          </button>
          <h3 id="mockup-creator-title">Create Mockup Template</h3>
          <button class="mockup-creator-close" id="mockup-creator-close" type="button">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="mockup-creator-body">
          <div class="mockup-creator-sidebar">
            <div class="mockup-creator-field">
              <label>Template Name</label>
              <input type="text" id="mockup-template-name" placeholder="e.g., White Frame on Wall">
            </div>
            <div class="mockup-creator-field" id="mockup-upload-field">
              <label>Upload Image</label>
              <input type="file" id="mockup-template-file" accept="image/png,image/jpeg">
              <p class="field-hint">Upload your mockup image (PNG or JPG)</p>
            </div>
            <div class="mockup-creator-field">
              <label>Collection (optional)</label>
              <select id="mockup-template-collection" class="mockup-creator-select">
                <option value="">None</option>
              </select>
            </div>
            <div class="mockup-creator-field">
              <label>Quick Formats</label>
              <p class="field-hint">Select a format and place it on the image, or draw manually.</p>
              <div class="format-selector-grid" id="format-selector-grid">
                <button type="button" class="format-btn" data-ratio="2:3" title="2:3 Poster">
                  <div class="format-btn-shape"><span style="width:16px;height:24px"></span></div>
                  <span class="format-btn-label">2:3</span>
                </button>
                <button type="button" class="format-btn" data-ratio="3:4" title="3:4 Photo">
                  <div class="format-btn-shape"><span style="width:18px;height:24px"></span></div>
                  <span class="format-btn-label">3:4</span>
                </button>
                <button type="button" class="format-btn" data-ratio="4:5" title="4:5 Frame">
                  <div class="format-btn-shape"><span style="width:19px;height:24px"></span></div>
                  <span class="format-btn-label">4:5</span>
                </button>
                <button type="button" class="format-btn" data-ratio="5:7" title="5:7 Frame">
                  <div class="format-btn-shape"><span style="width:17px;height:24px"></span></div>
                  <span class="format-btn-label">5:7</span>
                </button>
                <button type="button" class="format-btn" data-ratio="11:14" title="11:14 Frame">
                  <div class="format-btn-shape"><span style="width:19px;height:24px"></span></div>
                  <span class="format-btn-label">11:14</span>
                </button>
                <button type="button" class="format-btn" data-ratio="1:1" title="Square">
                  <div class="format-btn-shape"><span style="width:24px;height:24px"></span></div>
                  <span class="format-btn-label">1:1</span>
                </button>
                <button type="button" class="format-btn" data-ratio="A4" title="A4 ISO">
                  <div class="format-btn-shape"><span style="width:17px;height:24px"></span></div>
                  <span class="format-btn-label">A4</span>
                </button>
                <button type="button" class="format-btn" data-ratio="A3" title="A3 ISO">
                  <div class="format-btn-shape"><span style="width:17px;height:24px"></span></div>
                  <span class="format-btn-label">A3</span>
                </button>
                <button type="button" class="format-btn" data-ratio="3:2" title="3:2 Landscape">
                  <div class="format-btn-shape"><span style="width:24px;height:16px"></span></div>
                  <span class="format-btn-label">3:2</span>
                </button>
                <button type="button" class="format-btn" data-ratio="16:9" title="16:9 Wide">
                  <div class="format-btn-shape"><span style="width:24px;height:14px"></span></div>
                  <span class="format-btn-label">16:9</span>
                </button>
                <button type="button" class="format-btn" data-ratio="9:16" title="9:16 Tall">
                  <div class="format-btn-shape"><span style="width:14px;height:24px"></span></div>
                  <span class="format-btn-label">9:16</span>
                </button>
              </div>
              <div class="format-scale-row">
                <label>Scale</label>
                <button type="button" class="scale-arrow-btn" id="format-scale-down" title="Decrease size">−</button>
                <input type="range" id="format-scale-slider" class="format-scale-slider" min="5" max="100" value="30">
                <button type="button" class="scale-arrow-btn" id="format-scale-up" title="Increase size">+</button>
                <input type="text" id="format-scale-value" class="format-scale-value" value="30%">
              </div>
              <div class="format-actions">
                <button type="button" class="format-clear-btn" id="format-clear-btn">Clear</button>
              </div>
              <button type="button" class="format-place-btn" id="format-place-btn" disabled>Place on Image</button>
            </div>

            <div class="mockup-creator-field">
              <label>Poster Area</label>
              <p class="field-hint">Or click and drag on the image to draw manually.</p>
              <div class="mockup-rect-info" id="mockup-rect-info">
                <span>X: <b id="rect-x">0</b></span>
                <span>Y: <b id="rect-y">0</b></span>
                <span>W: <b id="rect-w">0</b></span>
                <span>H: <b id="rect-h">0</b></span>
              </div>
            </div>
          </div>
          <div class="mockup-creator-canvas-outer">
            <div class="canvas-zoom-controls" id="creator-zoom-controls">
              <button type="button" class="zoom-btn" id="creator-zoom-out" title="Zoom out">-</button>
              <span class="zoom-level" id="creator-zoom-level">100%</span>
              <button type="button" class="zoom-btn" id="creator-zoom-in" title="Zoom in">+</button>
              <button type="button" class="zoom-btn zoom-fit" id="creator-zoom-fit" title="Fit to view">Fit</button>
            </div>
            <button type="button" class="canvas-save-btn" id="mockup-save-btn" disabled>Save Template</button>
            <div class="mockup-creator-canvas-wrap">
              <div class="mockup-creator-placeholder" id="mockup-canvas-placeholder">
                Upload an image to get started
              </div>
              <div class="canvas-scroll-content">
                <canvas id="mockup-creator-canvas" style="display: none;"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- FLOATING BOTTOM BAR (bookmarks + search + recent toggle) -->
    <div id="bottom-bar-float" class="bottom-bar-float">
      <button id="bookmarks-toggle" class="bookmarks-toggle" type="button" title="City bookmarks">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/>
        </svg>
      </button>
      <div class="search-float-inner">
        <svg class="search-float-icon" viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <input
          type="text"
          id="location-search-float-input"
          placeholder="Search location..."
          autocomplete="off"
        />
        <div id="search-results-float" class="search-dropdown-float"></div>
      </div>
      <button id="recent-toggle" class="recent-toggle" type="button" title="Recent generations">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M13 3a9 9 0 0 0-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 0-18zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
        </svg>
      </button>
    </div>

    <!-- CITY BOOKMARKS PANEL -->
    <div id="city-bookmarks-panel" class="city-bookmarks-panel" aria-hidden="true">
      <div class="bookmarks-header">
        <span class="bookmarks-title">City Bookmarks</span>
        <button id="bookmarks-close" class="bookmarks-close" type="button" aria-label="Close">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      <div class="bookmarks-search-wrap">
        <svg class="bookmarks-search-icon" viewBox="0 0 24 24" width="16" height="16">
          <path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <input type="text" id="bookmarks-search" placeholder="Search cities..." autocomplete="off" />
      </div>
      <div id="bookmarks-content" class="bookmarks-content">
        <!-- Continent groups will be rendered here -->
      </div>
    </div>

    <!-- LATEST GENERATIONS PANEL (floating) -->
    <div id="recent-generations" class="recent-generations" aria-hidden="true">
      <div class="recent-header">
        <span class="recent-title">Recent</span>
        <button id="recent-close" class="recent-close" type="button" aria-label="Close">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      <div id="recent-grid" class="recent-grid">
        <!-- Recent posters will be rendered here -->
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="/static/app.js?v=41"></script>
  </body>
</html>
